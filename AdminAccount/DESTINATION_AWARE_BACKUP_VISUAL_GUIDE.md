# Destination-Aware Backup System - Visual Guide

## System Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    IBACMI Backup System                          â”‚
â”‚                 Destination-Aware Architecture                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ Student Documentsâ”‚
                    â”‚   (Uploads)      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Backup Destination Selector   â”‚
            â”‚   (User chooses destination)    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                â”‚                â”‚
        â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Google Drive â”‚  â”‚Local Storage â”‚  â”‚  Auto-Sync   â”‚
â”‚  Destination â”‚  â”‚ Destination  â”‚  â”‚ Destination  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                 â”‚                 â”‚
       â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚backup_manifestâ”‚ â”‚local_backup_ â”‚  â”‚backup_manifestâ”‚
â”‚    Table     â”‚  â”‚manifest Tableâ”‚  â”‚    Table     â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ - student_id â”‚  â”‚ - student_id â”‚  â”‚ - student_id â”‚
â”‚ - document_idâ”‚  â”‚ - document_idâ”‚  â”‚ - document_idâ”‚
â”‚ - file_hash  â”‚  â”‚ - file_hash  â”‚  â”‚ - file_hash  â”‚
â”‚ - gdrive_id  â”‚  â”‚ - local_path â”‚  â”‚ - gdrive_id  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     â–²                 â–²                 â–²
     â”‚                 â”‚                 â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               Each destination maintains
              its own independent state!
```

## Backup Decision Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BACKUP PROCESS FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

START: User initiates backup
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Select Destinationâ”‚
â”‚ - Google Drive            â”‚
â”‚ - Local Storage           â”‚
â”‚ - Manual Backup           â”‚
â”‚ - Auto-Sync              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Query Destination Manifest     â”‚
â”‚                                        â”‚
â”‚ IF Google Drive/Auto-Sync:             â”‚
â”‚   â†’ Query backup_manifest              â”‚
â”‚                                        â”‚
â”‚ IF Local/Manual:                       â”‚
â”‚   â†’ Query local_backup_manifest        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Identify Pending Files         â”‚
â”‚                                        â”‚
â”‚ FOR EACH document:                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ Is it in this manifest?         â”‚ â”‚
â”‚   â”‚  NO  â†’ Mark as PENDING (new)    â”‚ â”‚
â”‚   â”‚  YES â†’ Check hash               â”‚ â”‚
â”‚   â”‚    Changed?   â†’ PENDING (mod)   â”‚ â”‚
â”‚   â”‚    Unchanged? â†’ SKIP            â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Execute Backup                 â”‚
â”‚                                        â”‚
â”‚ FOR EACH pending file:                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ NEW file:                       â”‚ â”‚
â”‚   â”‚   - Upload/Copy to destination  â”‚ â”‚
â”‚   â”‚   - Add record to manifest      â”‚ â”‚
â”‚   â”‚                                 â”‚ â”‚
â”‚   â”‚ MODIFIED file:                  â”‚ â”‚
â”‚   â”‚   - Update at destination       â”‚ â”‚
â”‚   â”‚   - Update manifest record      â”‚ â”‚
â”‚   â”‚                                 â”‚ â”‚
â”‚   â”‚ SKIPPED file:                   â”‚ â”‚
â”‚   â”‚   - Do nothing                  â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Update Statistics              â”‚
â”‚ - Files uploaded/copied                â”‚
â”‚ - Files updated                        â”‚
â”‚ - Files skipped                        â”‚
â”‚ - Total time/size                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

END: Backup complete for THIS destination
(Other destinations remain independent)
```

## Example: 10 Files, 3 Destinations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              VISUAL EXAMPLE: FILE BACKUP STATUS                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Initial State (10 new documents uploaded):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Documents:  [1] [2] [3] [4] [5] [6] [7] [8] [9] [10]

Google Drive: [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ]
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ All 10 PENDING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Local Storage:[ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ]
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ All 10 PENDING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


After backing up files 1-5 to Google Drive:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Documents:  [1] [2] [3] [4] [5] [6] [7] [8] [9] [10]

Google Drive: [âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [ ] [ ] [ ] [ ] [ ]
              â””â”€â”€â”€â”€5 BACKED UPâ”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€5 PENDINGâ”€â”€â”€â”€â”˜

Local Storage:[ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ] [ ]
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ All 10 STILL PENDING â”€â”€â”€â”€â”€â”€â”˜
              (Independent from Google Drive!)


After backing up ALL files to Local Storage:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Documents:  [1] [2] [3] [4] [5] [6] [7] [8] [9] [10]

Google Drive: [âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [ ] [ ] [ ] [ ] [ ]
              â””â”€â”€â”€â”€5 BACKED UPâ”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€5 PENDINGâ”€â”€â”€â”€â”˜
              (Unchanged from before)

Local Storage:[âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [âœ“]
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ All 10 BACKED UP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              (Includes the 5 already on Google Drive!)


After uploading 3 NEW documents (11, 12, 13):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Documents:  [1] [2] [3] [4] [5] [6] [7] [8] [9] [10] [11] [12] [13]

Google Drive: [âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [ ] [ ] [ ] [ ] [ ]  [ ]  [ ]  [ ]
              â””â”€â”€â”€â”€5 BACKED UPâ”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€5 OLD PENDINGâ”€â”€â”€â”€â”˜ â””â”€3 NEWâ”€â”˜
              Total: 8 PENDING

Local Storage:[âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [âœ“] [ ]  [ ]  [ ]
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 10 BACKED UP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€3 NEWâ”€â”€â”˜
              Total: 3 PENDING
```

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   HOW DATA FLOWS IN THE SYSTEM                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User Action: "Create Backup to Google Drive"
â”‚
â”œâ”€â–º Frontend sends: POST /backup.php
â”‚   {
â”‚     action: "create_backup",
â”‚     storageType: "google_drive",
â”‚     schoolYear: "2025-2026"
â”‚   }
â”‚
â”œâ”€â–º Backend processes:
â”‚   â”‚
â”‚   â”œâ”€â–º Step 1: Create backup_logs entry
â”‚   â”‚   INSERT INTO backup_logs (storage_type, school_year, ...)
â”‚   â”‚
â”‚   â”œâ”€â–º Step 2: Get all students with documents
â”‚   â”‚   SELECT * FROM students WHERE has_documents = 1
â”‚   â”‚
â”‚   â”œâ”€â–º Step 3: For each student:
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â–º Get student's documents
â”‚   â”‚   â”‚   SELECT * FROM student_documents WHERE student_id = ?
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â–º For each document:
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â–º Check if already in backup_manifest
â”‚   â”‚   â”‚   â”‚   SELECT * FROM backup_manifest
â”‚   â”‚   â”‚   â”‚   WHERE student_id = ? AND document_id = ?
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â–º Calculate current file hash
â”‚   â”‚   â”‚   â”‚   $hash = md5_file($filePath)
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â–º Decision:
â”‚   â”‚   â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â”‚   â”‚   â”‚   â”‚ NOT in manifest?                â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â†’ Upload to Google Drive      â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â†’ INSERT into backup_manifest â”‚
â”‚   â”‚   â”‚   â”‚   â”‚                                 â”‚
â”‚   â”‚   â”‚   â”‚   â”‚ In manifest, hash CHANGED?      â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â†’ Update on Google Drive      â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â†’ UPDATE backup_manifest hash â”‚
â”‚   â”‚   â”‚   â”‚   â”‚                                 â”‚
â”‚   â”‚   â”‚   â”‚   â”‚ In manifest, hash SAME?         â”‚
â”‚   â”‚   â”‚   â”‚   â”‚   â†’ Skip (already backed up)    â”‚
â”‚   â”‚   â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â–º Record result (uploaded/updated/skipped)
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â–º Move to next document
â”‚   â”‚
â”‚   â””â”€â–º Step 4: Update backup_logs with final counts
â”‚       UPDATE backup_logs SET
â”‚         files_uploaded = ?,
â”‚         files_updated = ?,
â”‚         files_skipped = ?,
â”‚         status = 'success'
â”‚
â””â”€â–º Frontend receives:
    {
      status: "success",
      data: {
        student_count: 120,
        file_count: 450,
        files_uploaded: 25,    // NEW files
        files_updated: 5,      // MODIFIED files
        files_skipped: 420     // UNCHANGED files
      }
    }
```

## Comparison: Old vs New System

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             OLD SYSTEM (Before Destination-Aware)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Problem: Single shared state
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Backup to Google Drive (5 files)
         â†“
  backup_manifest table updated
         â†“
  System thinks ALL destinations have these files!
         â†“
  Local storage shows: 0 pending âŒ
  (Even though nothing was copied locally!)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             NEW SYSTEM (Destination-Aware)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Solution: Independent state per destination
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  Backup to Google Drive (5 files)
         â†“
  backup_manifest table updated
         â†“
  Google Drive: 5 backed up âœ“
         
  Local storage is independent!
         â†“
  local_backup_manifest NOT affected
         â†“
  Local storage shows: 10 pending âœ“
  (Correct! Nothing copied locally yet)
```

## Performance Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PERFORMANCE VISUALIZATION                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario: Backup 100 files (90 unchanged, 10 new)

OLD SYSTEM (No Duplicate Prevention):
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
Upload: 100 files
Time: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10 minutes
Bandwidth: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 500 MB


NEW SYSTEM (With Destination-Aware Duplicate Prevention):
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
Upload: 10 files only
Time: â–ˆâ–ˆâ–ˆâ–ˆ 1 minute  (90% faster!)
Bandwidth: â–ˆâ–ˆâ–ˆâ–ˆ 50 MB  (90% less bandwidth!)

Files Skipped: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 90
              (Already backed up, unchanged)


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Efficiency Gains:                                                â”‚
â”‚ âœ“ 90% reduction in upload time                                   â”‚
â”‚ âœ“ 90% reduction in bandwidth usage                               â”‚
â”‚ âœ“ 90% reduction in API calls                                     â”‚
â”‚ âœ“ 100% increase in user happiness! ğŸ˜Š                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## State Machine Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              DOCUMENT STATE PER DESTINATION                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   UPLOADED  â”‚
                    â”‚ (New Document)â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  PENDING    â”‚â—„â”€â”€â”€â”€â”€â”
                    â”‚ (Not in     â”‚      â”‚
                    â”‚  manifest)  â”‚      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚
                           â”‚             â”‚
                 Backup    â”‚             â”‚ File
                 Started   â”‚             â”‚ Modified
                           â–¼             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
                    â”‚ BACKING UP  â”‚      â”‚
                    â”‚ (In progress)â”‚      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â”‚
                           â”‚             â”‚
                 Success   â”‚             â”‚
                           â–¼             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
                    â”‚ BACKED UP   â”‚      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ (In manifestâ”œâ”€â”€â”€â”€â”€â”€â”˜
        â”‚           â”‚  w/ hash)   â”‚
        â”‚           â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                  â”‚
        â”‚        File      â”‚ No
        â”‚        Changed?  â”‚ Change
        â”‚                  â”‚
        â”‚         Yes      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Each destination has its OWN state machine!
Google Drive state â‰  Local Storage state
```

## Quick Reference Card

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         DESTINATION-AWARE BACKUP QUICK REFERENCE              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  Destinations:                                                â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚ google_drive     â”‚ Google Drive cloud backups         â”‚  â•‘
â•‘  â”‚ local            â”‚ Local folder backups               â”‚  â•‘
â•‘  â”‚ manual           â”‚ Manual backup location             â”‚  â•‘
â•‘  â”‚ auto_sync        â”‚ Automatic Google Drive sync        â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                               â•‘
â•‘  Manifest Tables:                                             â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â•‘
â•‘  â”‚ backup_manifest      â”‚ Google Drive/Auto-Sync       â”‚    â•‘
â•‘  â”‚ local_backup_manifestâ”‚ Local/Manual backups         â”‚    â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â•‘
â•‘                                                               â•‘
â•‘  Key API Functions:                                           â•‘
â•‘  â€¢ getPendingFilesCountByDestination($dest)                   â•‘
â•‘  â€¢ getPendingFilesByDestination($dest, $yearId)               â•‘
â•‘  â€¢ isDocumentBackedUpToGoogleDrive($sid, $did)                â•‘
â•‘  â€¢ isDocumentBackedUpLocally($sid, $did)                      â•‘
â•‘                                                               â•‘
â•‘  API Endpoints:                                               â•‘
â•‘  GET /backup.php?action=get_backup_statistics&destination=X   â•‘
â•‘  GET /backup.php?action=get_pending_files_by_destination      â•‘
â•‘                  &destination=X&school_year_id=Y              â•‘
â•‘                                                               â•‘
â•‘  Remember:                                                    â•‘
â•‘  âœ“ Each destination is INDEPENDENT                            â•‘
â•‘  âœ“ Files backed up to one destination don't affect others     â•‘
â•‘  âœ“ Unchanged files are automatically SKIPPED                  â•‘
â•‘  âœ“ Modified files are automatically UPDATED                   â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

**This visual guide complements the technical documentation.**  
**For detailed implementation, see DESTINATION_AWARE_BACKUP_SYSTEM.md**
